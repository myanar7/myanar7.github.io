<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mahjong Solitaire - SVG Tile'lÄ±</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:Arial, sans-serif;
  background:linear-gradient(135deg,#667eea,#764ba2);
  min-height:100vh;display:flex;align-items:center;justify-content:center;color:#fff;
}
.game-container{
  background:rgba(255,255,255,0.08);backdrop-filter:blur(10px);border-radius:16px;padding:18px;
  box-shadow:0 8px 32px rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.12);
  max-width:96vw;overflow:auto;
}
.game-title{font-size:2rem;text-align:center;margin-bottom:10px;
  background:linear-gradient(45deg,#ffd700,#ffed4e);-webkit-background-clip:text;-webkit-text-fill-color:transparent;
}
.game-info{display:flex;justify-content:space-between;margin-bottom:12px;padding:8px 14px;background:rgba(255,255,255,0.06);border-radius:10px}
.score,.moves{font-weight:700}
.game-board{
  position:relative;background:linear-gradient(145deg,#2c3e50,#34495e);border-radius:12px;padding:18px;
  min-width:800px;min-height:600px; box-shadow: inset 0 4px 8px rgba(0,0,0,0.25);
}

/* Tile */
.tile{
  position:absolute;
  width:60px;height:80px;
  background-color:#f8f9fa;border:2px solid #dee2e6;border-radius:8px;
  display:flex;align-items:center;justify-content:center;cursor:pointer;
  transition:all .28s ease;box-shadow:0 4px 8px rgba(0,0,0,0.18);
  user-select:none;
  background-size:70% 70%;
  background-repeat:no-repeat;background-position:center;
}
.tile:hover{transform:translateY(-5px);box-shadow:0 8px 18px rgba(0,0,0,0.28);border-color:#ffd700}
.tile.selected{transform:translateY(-8px);box-shadow:0 12px 24px rgba(255,107,107,0.35);border-color:#ff6b6b;background:linear-gradient(145deg,#ffd700,#ffed4e)}
.tile.matched{opacity:.28;transform:scale(.8);pointer-events:none}
.tile.removing{animation:removeTile .45s ease-out forwards}
@keyframes removeTile{ to{opacity:0; transform:scale(0) rotate(180deg)} }

.win-message{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
  background:linear-gradient(145deg,#2ecc71,#27ae60);padding:34px;border-radius:14px;color:#fff;z-index:1000;box-shadow:0 20px 40px rgba(0,0,0,.45)
}
.video-container{display:none;position:fixed;inset:0;background:rgba(0,0,0,.9);align-items:center;justify-content:center;z-index:2000}
.video-container video{max-width:90%;max-height:90%;border-radius:10px;box-shadow:0 20px 40px rgba(0,0,0,.8)}
.close-video{position:absolute;top:18px;right:26px;background:rgba(255,255,255,.18);border:none;color:#fff;font-size:1.6rem;border-radius:50%;width:48px;height:48px}
.close-video:hover{background:rgba(255,255,255,.28)}

@media (max-width:768px){
  .game-board{min-width:600px;min-height:500px}
  .tile{width:50px;height:70px}
}
</style>
</head>
<body>
  <div class="game-container">
    <h1 class="game-title">ðŸŽ´ Mahjong Solitaire ðŸŽ´</h1>
    <div class="game-info">
      <div class="score">Puan: <span id="score">0</span></div>
      <div class="moves">Hamle: <span id="moves">0</span></div>
    </div>
    <div class="game-board" id="gameBoard"></div>
  </div>

  <div class="win-message" id="winMessage">
    <h2>ðŸŽ‰ Tebrikler! ðŸŽ‰</h2>
    <p>Oyunu baÅŸarÄ±yla tamamladÄ±nÄ±z!</p>
    <p>SÃ¼rpriz videonuz aÃ§Ä±lÄ±yor...</p>
  </div>

  <div class="video-container" id="videoContainer">
    <button class="close-video" onclick="closeVideo()">Ã—</button>
    <video id="surpriseVideo" controls>
      <source src="IMG_1482.mp4" type="video/mp4">
    </video>
  </div>

<script>
/* ---------- SVG kaynaklarÄ± (dÃ¼z metin) ---------- */
/* Not: bu SVG metinleri runtime'da encodeURIComponent ile gÃ¼venli data-uri'ye Ã§evriliyor */
const TILE_SVGS = {
  WALL: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 80"><rect width="60" height="80" fill="#b0bec5"/><path d="M0 20h60M0 40h60M0 60h60" stroke="#888" stroke-width="4" stroke-linecap="round"/></svg>`,
  FLOOR: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 80"><rect width="60" height="80" fill="#a1887f"/><circle cx="30" cy="40" r="5" fill="#8d6e63"/></svg>`,
  DOOR: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 80"><rect x="10" y="10" width="40" height="60" rx="5" fill="#a0522d"/><circle cx="40" cy="40" r="3" fill="#ffd700"/></svg>`,
  WATER: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 80"><rect width="60" height="80" fill="#0099ff"/><path d="M0 40q10-10 20 0t20 0t20 0" fill="none" stroke="#fff" stroke-width="3"/></svg>`,
  LAVA: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 80"><rect width="60" height="80" fill="#ff4500"/><path d="M0 60q10-20 20 0t20 0t20 0" fill="none" stroke="#ffff00" stroke-width="3"/></svg>`,
  GRASS: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 80"><rect width="60" height="80" fill="#4caf50"/><path d="M10 70l5-20 5 20M30 70l5-20 5 20M50 70l5-20 5 20" stroke="#080" stroke-width="3" fill="none"/></svg>`,
  CHEST: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 80"><rect x="10" y="20" width="40" height="40" fill="#a0522d"/><rect x="10" y="35" width="40" height="10" fill="#d2b48c"/><circle cx="30" cy="40" r="3" fill="#ffd700"/></svg>`,
  ENEMY: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 80"><circle cx="30" cy="40" r="25" fill="#d32f2f"/><circle cx="20" cy="35" r="5" fill="#fff"/><circle cx="40" cy="35" r="5" fill="#fff"/><path d="M20 55q10-5 20 0" stroke="#fff" stroke-width="3" fill="none"/></svg>`,
  PLAYER: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 80"><circle cx="30" cy="25" r="10" fill="#ffeb3b"/><rect x="20" y="35" width="20" height="25" fill="#003996"/></svg>`,
  TREE: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 80"><rect x="25" y="50" width="10" height="20" fill="#8d6e63"/><circle cx="30" cy="40" r="20" fill="#4caf50"/></svg>`,
  ROCK: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 80"><ellipse cx="30" cy="50" rx="25" ry="15" fill="#9e9e9e"/></svg>`,
  BRIDGE: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 80"><rect y="40" width="60" height="10" fill="#8d6e63"/><path d="M0 40q30-20 60 0" fill="none" stroke="#d7ccc8" stroke-width="3"/></svg>`,
  STAIRS_UP: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 80"><path d="M10 60h40v-10H20v-10h30v-10H30v-10H10" stroke="#fff" stroke-width="3" fill="none"/></svg>`,
  STAIRS_DOWN: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 80"><path d="M10 20h40v10H20v10h30v10H30v10H10" stroke="#fff" stroke-width="3" fill="none"/></svg>`,
  KEY: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 80"><circle cx="20" cy="40" r="10" fill="#ffd700"/><rect x="30" y="38" width="20" height="4" fill="#ffd700"/></svg>`,
  LOCK: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 80"><rect x="15" y="35" width="30" height="30" fill="#9e9e9e"/><path d="M20 35v-10a10 10 0 0120 0v10" stroke="#9e9e9e" stroke-width="4" fill="none"/></svg>`,
  BOSS: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 80"><circle cx="30" cy="40" r="25" fill="#8e24aa"/><path d="M15 25l10 5-10 5M45 25l-10 5 10 5" fill="#fff"/></svg>`,
  TORCH: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 80"><rect x="25" y="50" width="10" height="20" fill="#8d6e63"/><path d="M30 40l5-15-5 5-5-5z" fill="#ff9800"/></svg>`,
  TRAP: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 80"><polygon points="0,60 60,60 30,20" fill="#b71c1c"/></svg>`,
  EMPTY: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 80"><rect width="60" height="80" fill="#ccc"/></svg>`
};

/* ---------- data-uri Ã¼retici ve cache ---------- */
function svgToDataUri(svg) {
  // encodeURIComponent ile gÃ¼venli hale getir
  return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
}
const TILE_ICONS = {};
Object.keys(TILE_SVGS).forEach(k => { TILE_ICONS[k] = svgToDataUri(TILE_SVGS[k]); });

/* ---------- Oyun sÄ±nÄ±fÄ± (eski mantÄ±ÄŸÄ± koruyoruz) ---------- */
class MahjongGame {
  constructor() {
    this.board = document.getElementById('gameBoard');
    this.scoreElement = document.getElementById('score');
    this.movesElement = document.getElementById('moves');
    this.winMessage = document.getElementById('winMessage');
    this.videoContainer = document.getElementById('videoContainer');
    this.surpriseVideo = document.getElementById('surpriseVideo');

    this.score = 0; this.moves = 0; this.selectedTile = null; this.tiles = []; this.gameWon = false;

    // KullanacaÄŸÄ±mÄ±z tile tipleri (senin verdiÄŸin 20 tip)
    this.tileTypes = [
      'WALL','FLOOR','DOOR','WATER','LAVA','GRASS','CHEST','ENEMY','PLAYER','TREE',
      'ROCK','BRIDGE','STAIRS_UP','STAIRS_DOWN','KEY','LOCK','BOSS','TORCH','TRAP','EMPTY'
    ];

    this.initGame();
  }

  initGame(){
    this.createBoard();
    this.updateDisplay();
  }

  createBoard() {
    // Daha Ã¶nce seninle uyarladÄ±ÄŸÄ±mÄ±z dengeli dÃ¼zen (piramit-benzeri ama Ã§Ã¶zÃ¼lebilir)
    const layout = [
      // Alt katman (geniÅŸ taban)
      {x:100,y:400,z:0},{x:180,y:400,z:0},{x:260,y:400,z:0},{x:340,y:400,z:0},{x:420,y:400,z:0},{x:500,y:400,z:0},{x:580,y:400,z:0},
      {x:100,y:320,z:0},{x:180,y:320,z:0},{x:260,y:320,z:0},{x:340,y:320,z:0},{x:420,y:320,z:0},{x:500,y:320,z:0},{x:580,y:320,z:0},
      {x:100,y:240,z:0},{x:180,y:240,z:0},{x:260,y:240,z:0},{x:340,y:240,z:0},{x:420,y:240,z:0},{x:500,y:240,z:0},{x:580,y:240,z:0},

      // Orta katman (daha dar)
      {x:140,y:360,z:1},{x:220,y:360,z:1},{x:300,y:360,z:1},{x:380,y:360,z:1},{x:460,y:360,z:1},{x:540,y:360,z:1},
      {x:140,y:280,z:1},{x:220,y:280,z:1},{x:300,y:280,z:1},{x:380,y:280,z:1},{x:460,y:280,z:1},{x:540,y:280,z:1},

      // Ãœst katman
      {x:180,y:320,z:2},{x:260,y:320,z:2},{x:340,y:320,z:2},{x:420,y:320,z:2},{x:500,y:320,z:2},

      // En Ã¼st katman
      {x:260,y:240,z:3},{x:340,y:240,z:3},{x:420,y:240,z:3},

      // Zirve
      {x:340,y:160,z:4}
    ];

    // Tile Ã§iftleri oluÅŸtur (layout uzunluÄŸunun yarÄ±sÄ± kadar Ã§ift)
    const tilePairs = [];
    for (let i = 0; i < Math.floor(layout.length / 2); i++) {
      const tileType = this.tileTypes[i % this.tileTypes.length];
      tilePairs.push(tileType, tileType);
    }

    this.shuffleArray(tilePairs);

    this.tiles = [];
    layout.forEach((pos, index) => {
      if (index < tilePairs.length) {
        const tile = this.createTile(tilePairs[index], pos, index);
        this.tiles.push(tile);
        this.board.appendChild(tile.element);
      }
    });
  }

  createTile(type, position, id) {
    const tileElement = document.createElement('div');
    tileElement.className = 'tile';
    tileElement.style.left = position.x + 'px';
    tileElement.style.top = position.y + 'px';
    tileElement.style.zIndex = position.z;
    // Arka plan olarak gÃ¼venli data-uri kullan
    const svgDataUri = TILE_ICONS[type] || TILE_ICONS.EMPTY;
    tileElement.style.backgroundImage = `url("${svgDataUri}")`;

    const tile = { id, type, element: tileElement, position, matched: false, removable: false };

    tileElement.addEventListener('click', () => this.selectTile(tile));
    return tile;
  }

  selectTile(tile) {
    if (tile.matched || !this.isTileRemovable(tile)) return;

    if (this.selectedTile === null) {
      this.selectedTile = tile;
      tile.element.classList.add('selected');
    } else if (this.selectedTile === tile) {
      this.selectedTile.element.classList.remove('selected');
      this.selectedTile = null;
    } else if (this.selectedTile.type === tile.type) {
      this.matchTiles(this.selectedTile, tile);
      this.selectedTile = null;
    } else {
      this.selectedTile.element.classList.remove('selected');
      this.selectedTile = tile;
      tile.element.classList.add('selected');
    }
  }

  matchTiles(tile1, tile2) {
    tile1.matched = true; tile2.matched = true;
    tile1.element.classList.add('matched','removing');
    tile2.element.classList.add('matched','removing');
    this.score += 100; this.moves++; this.updateDisplay();
    setTimeout(()=>{ tile1.element.remove(); tile2.element.remove(); this.checkWin(); }, 450);
  }

  isTileRemovable(tile) {
    // Ãœstte taÅŸ var mÄ± kontrolÃ¼ (basit - bizim dÃ¼zen iÃ§in yeterli)
    const blocking = this.tiles.filter(other =>
      !other.matched &&
      other.id !== tile.id &&
      other.position.z > tile.position.z &&
      Math.abs(other.position.x - tile.position.x) < 80 &&
      Math.abs(other.position.y - tile.position.y) < 100
    );
    return blocking.length === 0;
  }

  checkWin() {
    const remaining = this.tiles.filter(t => !t.matched);
    if (remaining.length === 0) { this.gameWon = true; this.showWinMessage(); }
  }

  showWinMessage() {
    this.winMessage.style.display = 'block';
    setTimeout(()=>{ this.winMessage.style.display='none'; this.videoContainer.style.display='flex';
      // autoplay bazen engellenir; try/catch
      try{ this.surpriseVideo.play(); } catch(e) { console.log('Video oynatÄ±lamadÄ±:', e); }
    }, 2000);
  }

  updateDisplay(){ this.scoreElement.textContent = this.score; this.movesElement.textContent = this.moves; }
  shuffleArray(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }
}

/* ---------- YardÄ±mcÄ±lar ---------- */
function closeVideo(){ document.getElementById('videoContainer').style.display='none'; document.getElementById('surpriseVideo').pause(); }

window.addEventListener('load', ()=>{ new MahjongGame(); });
document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeVideo(); });
</script>
</body>
</html>
